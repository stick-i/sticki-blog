# LeetCode å‰‘æŒ‡ Offer 35. å¤æ‚é“¾è¡¨çš„å¤åˆ¶

## é¢˜ç›®æè¿°

è¯·å®ç° copyRandomList å‡½æ•°ï¼Œå¤åˆ¶ä¸€ä¸ªå¤æ‚é“¾è¡¨ã€‚åœ¨å¤æ‚é“¾è¡¨ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹é™¤äº†æœ‰ä¸€ä¸ª next æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿˜æœ‰ä¸€ä¸ª random æŒ‡é’ˆæŒ‡å‘é“¾è¡¨ä¸­çš„ä»»æ„èŠ‚ç‚¹æˆ–è€… nullã€‚

**ç¤ºä¾‹ 1ï¼š**

![img](https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/01/09/e1.png)

```
è¾“å…¥ï¼šhead = [[7,null],[13,0],[11,4],[10,2],[1,0]]
è¾“å‡ºï¼š[[7,null],[13,0],[11,4],[10,2],[1,0]]
```

**ç¤ºä¾‹ 2ï¼š**

![img](https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/01/09/e2.png)

```
è¾“å…¥ï¼šhead = [[1,1],[2,1]]
è¾“å‡ºï¼š[[1,1],[2,1]]
```

**ç¤ºä¾‹ 3ï¼š**

```
è¾“å…¥ï¼šhead = []
è¾“å‡ºï¼š[]
è§£é‡Šï¼šç»™å®šçš„é“¾è¡¨ä¸ºç©ºï¼ˆç©ºæŒ‡é’ˆï¼‰ï¼Œå› æ­¤è¿”å› nullã€‚
```

**æç¤ºï¼š**

- -10000 <= Node.val <= 10000
- Node.random ä¸ºç©ºï¼ˆnullï¼‰æˆ–æŒ‡å‘é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ã€‚
- èŠ‚ç‚¹æ•°ç›®ä¸è¶…è¿‡ 1000 ã€‚

**é¢˜ç›®é“¾æ¥**
[https://leetcode.cn/problems/fu-za-lian-biao-de-fu-zhi-lcof](https://leetcode.cn/problems/fu-za-lian-biao-de-fu-zhi-lcof)

## è§£é¢˜æ€è·¯
è¿™é¢˜æˆ‘åˆšå¼€å§‹ä¹Ÿæ²¡çœ‹æ‡‚é¢˜ï¼Œç›´æ¥`return head;` ç„¶åå°±æäº¤äº†ğŸ¤£ğŸ¤£

ç„¶åå‘ç°ä¸å¯¹ï¼Œå®ƒé¢˜ç›®çš„æ„æ€æ˜¯ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹ä½ éƒ½å¿…é¡»é‡æ–°newä¸€ä¸ªæ‰è¡Œï¼Œåªè¦ä½ çš„é“¾è¡¨èŠ‚ç‚¹ä¸­æœ‰å¯¹å®ƒåŸæ¥çš„é“¾è¡¨çš„å¼•ç”¨é‚£å°±ä¸å¯¹ã€‚

äºæ˜¯æˆ‘æƒ³åˆ°äº†ç”¨mapæ˜ å°„çš„æ–¹æ³•å†™å‡ºäº†è¿™é“é¢˜ï¼Œåæ¥çœ‹åˆ°è¯„è®ºåŒºå¤§å“¥ä»¬è¯´å¦ä¸€ç§æ€è·¯ï¼Œäºæ˜¯æˆ‘ç”¨é‚£ç§æ€è·¯ä¹Ÿå®ç°äº†ä¸€éï¼Œéƒ½è´´åœ¨ä¸‹é¢äº†ã€‚

### Mapæ˜ å°„æ³•
æ—¶é—´å¤æ‚åº¦O(n) ï¼Œç©ºé—´å¤æ‚åº¦O(1)ã€‚

å¤§è‡´æ€è·¯ï¼š
- å°†æ–°èŠ‚ç‚¹å…ˆä¸²æˆæ™®é€šé“¾è¡¨ï¼Œå¹¶å°†æ–°èŠ‚ç‚¹å’Œè€èŠ‚ç‚¹å¯¹åº”çš„putåˆ°mapä¸­
- å°†æ–°é“¾è¡¨çš„æ¯ä¸€ä¸ªrandomè¿›è¡Œæ›´æ–°ï¼Œé€šè¿‡mapä¸­çš„æ˜ å°„å…³ç³»ã€‚

```java
class Solution {
    public Node copyRandomList(Node head) {
        HashMap<Node, Node> map = new HashMap<>(2000);
        Node first = new Node(0);
        Node cur = first;
        // å°†æ–°èŠ‚ç‚¹å…ˆä¸²æˆæ™®é€šé“¾è¡¨ï¼Œå¹¶å°†æ–°èŠ‚ç‚¹å’Œè€èŠ‚ç‚¹å¯¹åº”çš„putåˆ°mapä¸­
        while ( head != null) {
            cur.next = new Node(head.val);
            cur.next.random = head.random;
            map.put(head,cur.next);
            cur = cur.next;
            head = head.next;
        }
        // å°†æ–°é“¾è¡¨çš„æ¯ä¸€ä¸ªrandomè¿›è¡Œæ›´æ–°ï¼Œé€šè¿‡mapä¸­çš„æ˜ å°„å…³ç³»ã€‚
        cur = first.next;
        while ( cur != null ) {
            if (cur.random != null) {
                cur.random = map.get(cur.random);
            }
            cur = cur.next;
        }
        return first.next;
    }
}
```
è¿è¡Œæˆªå›¾

![image-20221017224854036](image/image-20221017224854036.png)


### åŸåœ°æ›´æ–°æ³•

æ—¶é—´å¤æ‚åº¦O(n) ï¼Œç©ºé—´å¤æ‚åº¦O(1)ã€‚

è¿™ä¸ªæ–¹æ³•ä¸ªäººæ„Ÿè§‰æ¯”HashMapéš¾æƒ³ä¸€ç‚¹ï¼Œè€Œä¸”å®ƒæ­¥éª¤ä¹Ÿå¤šä¸€ç‚¹ï¼Œæˆ‘åˆ†ä¸ºäº†ä¸‰æ­¥ï¼š

1. å…ˆåœ¨æ¯ä¸ªèŠ‚ç‚¹åé¢éƒ½å¤åˆ¶ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ï¼Œä¾‹å¦‚å¯¹äºé“¾è¡¨ A â†’ B â†’ Cï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ‹†åˆ†ä¸º A â†’ A' â†’ B â†’ B' â†’ C â†’ C'ã€‚
2. ç„¶åæŠŠæ–°ç»“ç‚¹çš„randomèŠ‚ç‚¹è¿›è¡Œè°ƒæ•´ï¼Œä¿®æ”¹ä¸ºç›®æ ‡èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚
3. æŠŠä¸¤ä¸ªé“¾è¡¨è¿›è¡Œåˆ†ç¦»ï¼Œè¿”å›æ–°é“¾è¡¨ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦æŠŠåŸæ¥çš„é“¾è¡¨ä¹Ÿè¿›è¡Œè¿˜åŸï¼Œä¸èƒ½åªæŠŠè‡ªå·±çš„é“¾è¡¨æ‹¼æ¥å°±ä¸ç®¡æ—§é“¾è¡¨äº†ï¼Œå¦åˆ™ç³»ç»Ÿä¼šåˆ¤é”™ã€‚

==è¿™ä¸ªæ–¹æ³•å»ºè®®åœ¨è‰ç¨¿çº¸ä¸Šå…ˆç”»ä¸€ä¸‹å›¾è§£ï¼Œåˆ¤æ–­ä¸€ä¸‹æŒ‡é’ˆæ”¹å¦‚ä½•æ”¹å˜ï¼Œå†è§£é¢˜ã€‚==

```java
class Solution {
    public Node copyRandomList(Node head) {
        if (head == null) {
            return head;
        }
        Node h = head;
        // ç¬¬ä¸€æ­¥å…ˆåœ¨æ¯ä¸ªèŠ‚ç‚¹åé¢éƒ½å¤åˆ¶ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹
        while (head != null) {
            Node temp = new Node(head.val);
            temp.next = head.next;
            head.next = temp;
            head = head.next.next;
        }
        // ç¬¬äºŒæ­¥æŠŠæ–°ç»“ç‚¹çš„randomèŠ‚ç‚¹è¿›è¡Œè°ƒæ•´
        head = h;
        while (head != null) {
            Node cur = head.next;
            if (head.random != null) {
                cur.random = head.random.next;
            }
            head = head.next.next;
        }
        // ç¬¬ä¸‰æ­¥æŠŠä¸¤ä¸ªé“¾è¡¨è¿›è¡Œåˆ†ç¦»
        head = h;
        Node myHead = head.next;
        while (head != null && head.next.next != null) {
            Node cur = head.next;
            head.next = head.next.next;
            cur.next = cur.next.next;
            head = head.next;
        }
        // è¿™é‡Œè¦æŠŠæœ€åèŠ‚ç‚¹çš„nextæŒ‡å‘null
        head.next = null;
        return myHead;
    }

}
```
è¿è¡Œæˆªå›¾

![image-20221017224915927](image/image-20221017224915927.png)