# ä¸€ä¸ªçœ‹ä¼¼æ™®é€šçš„å®šæ—¶ä»»åŠ¡ï¼Œå¦‚ä½•ä¼˜é›…åœ°æ¯æ‰æ•´å°æœåŠ¡å™¨

> æœ¬æ–‡é€‚åˆæ‰€æœ‰å†™è¿‡ `@Scheduled` çš„æœ‹å‹é˜…è¯»ï¼Œå†™å®Œä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œåˆ«æ€¥ç€éƒ¨ç½²ï¼Œçœ‹å®Œè¿™ç¯‡æ–‡ç« ä½ å¯èƒ½ä¼šæ•‘ä¸‹è‡ªå®¶çš„ç”Ÿäº§æœåŠ¡å™¨ã€‚
>

## ä¸€ã€æ•…äº‹ä»ä¸€ä¸ªäººç•œæ— å®³çš„æ³¨è§£å¼€å§‹
ä½ å¯èƒ½ç»å†è¿‡è¿™æ ·çš„åœºæ™¯ï¼š

â€œè¿™ä¸ªä»»åŠ¡æ¯10ç§’æ‰§è¡Œä¸€æ¬¡ï¼ŒæŸ¥ä¸€ä¸‹æ•°æ®åº“å°±è¡Œï¼Œå¾ˆç®€å•ã€‚â€  
äºæ˜¯ä½ ä¿¡å¿ƒæ»¡æ»¡åœ°å†™ä¸‹äº†ï¼š

```java
@Scheduled(fixedRate = 10000)
public void checkOrderStatus() {
    List<Order> orders = orderService.getPendingOrders();
    for (Order order : orders) {
        orderService.syncOrderStatus(order);
    }
}
```

ä½ å†™å®Œåä¸€æ‹å¤§è…¿ï¼š**æˆ‘çœŸæ˜¯ä¸ªå¤©æ‰ï¼**

ç»“æœä¸Šçº¿3åˆ†é’Ÿåï¼Œæ•°æ®åº“æŠ¥è­¦ã€CPUé£™é«˜ã€æœåŠ¡è¶…æ—¶ã€è€æ¿ç”µè¯å“äº†ï¼Œä½ è¿˜æ²¡æ¥å¾—åŠæ‚ä½è€³æœµã€‚

<!-- è¿™æ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œocr å†…å®¹ä¸ºï¼š -->
![](https://cdn.nlark.com/yuque/0/2025/jpeg/29587979/1750056207968-e35096fa-f614-45c2-997f-95152bc44ef2.jpeg)

## äºŒã€å®šæ—¶ä»»åŠ¡çš„â€œé˜´é—´è®¾è®¡â€ç°åœº
è¡¨é¢ä¸Šè¿™ä¸ªä»»åŠ¡ç®€å•åˆ°ä¸èƒ½å†ç®€å•ï¼Œå®é™…å®ƒè¸©çš„å‘ï¼Œä¸€ä¸ªæ¯”ä¸€ä¸ªè‡´å‘½ï¼š

### 1. `fixedRate` æ˜¯å•¥æ„æ€ä½ çœŸçš„ç†è§£äº†å—ï¼Ÿ
`@Scheduled(fixedRate = 10000)` çš„æ„æ€æ˜¯ï¼š**ä»»åŠ¡å¼€å§‹åï¼Œè¿‡ 10 ç§’å†è§¦å‘ä¸‹ä¸€æ¬¡**ï¼Œ**ä¸ç®¡ä¸Šä¸€æ¬¡æœ‰æ²¡æœ‰æ‰§è¡Œå®Œ**ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ `checkOrderStatus()` æ‰§è¡Œäº† 15 ç§’ï¼Œé‚£ä¸‹ä¸€ä¸ªä»»åŠ¡ä¼šåœ¨ç¬¬ 10 ç§’å¼ºè¡Œå¼€å§‹ã€‚è¿™å°±åƒä¸¤ä¸ªæ±‰å ¡æ²¡åƒå®Œï¼Œç¬¬ä¸‰ä¸ªå·²ç»é€æ¥äº†ã€‚

**åæœï¼šçº¿ç¨‹å †ç§¯ï¼Œä»»åŠ¡é‡å æ‰§è¡Œï¼Œäº‰æŠ¢èµ„æºï¼ŒæœåŠ¡å™¨çˆ†ç‚¸**ğŸ’£**ã€‚**

#### æ­£ç¡®å§¿åŠ¿ï¼š
```java
@Scheduled(fixedDelay = 10000)
```

å®ƒçš„æ„æ€æ˜¯ï¼š**ä¸Šæ¬¡æ‰§è¡Œå®Œä¹‹åå†ç­‰10ç§’ï¼Œå†æ‰§è¡Œä¸‹ä¸€æ¬¡ã€‚**

å¦‚æœä½ è¿˜æƒ³æ›´ç¨³å¦¥ä¸€ç‚¹ï¼Œå»ºè®®ç”¨ `ScheduledExecutorService` æˆ–åŠ ä¸ªåˆ†å¸ƒå¼é”ï¼ˆåé¢è¯¦ç»†è®²ï¼‰ã€‚

### 2. æ²¡æœ‰çº¿ç¨‹æ± é…ç½® = è‡ªæ€å¼å¤šçº¿ç¨‹çˆ†ç ´
Spring é»˜è®¤çš„ `@Scheduled` èƒŒåæ˜¯ `TaskScheduler`ï¼Œæ²¡é…ç½®çº¿ç¨‹æ± çš„è¯ï¼Œå®ƒå°±é»˜è®¤ç”¨å•çº¿ç¨‹è·‘æ‰€æœ‰ä»»åŠ¡ã€‚

å¦‚æœä½ æœ‰å¤šä¸ª `@Scheduled`ï¼Œå®ƒä»¬ä¼šæ’é˜Ÿæ‰§è¡Œï¼Œä¸€æ—¦æŸä¸ªä»»åŠ¡æ‰§è¡Œå¤ªæ…¢ï¼Œå…¶ä»–ä»»åŠ¡å°±å¼€å§‹æŒ¤ç‰™è†ã€‚

ä½ ä»¥ä¸ºå®ƒä»¬åœ¨â€œå¹¶å‘æ‰§è¡Œâ€ï¼Œå…¶å®å®ƒä»¬åœ¨â€œæ’é˜Ÿè‡ªæ€â€ã€‚

#### æ­£ç¡®å§¿åŠ¿ï¼Œé…ç½®ä»»åŠ¡çº¿ç¨‹æ± ï¼š
```java
@Configuration
@EnableScheduling
public class SchedulerConfig {
    @Bean
    public TaskScheduler taskScheduler() {
        ThreadPoolTaskScheduler scheduler = new ThreadPoolTaskScheduler();
        scheduler.setPoolSize(5); // æ ¹æ®ä¸šåŠ¡åˆç†é…ç½®
        scheduler.setThreadNamePrefix("my-task-");
        scheduler.initialize();
        return scheduler;
    }
}
```

### 3. æ—¥å¿—æ‰“å¾—é£èµ·ï¼Ÿç£ç›˜è¡¨ç¤ºå·²å’
å¾ˆå¤šäººä¸ºäº†è°ƒè¯•æ–¹ä¾¿ï¼Œä¼šåœ¨å®šæ—¶ä»»åŠ¡é‡Œç‹‚æ‰“æ—¥å¿—ï¼š

```java
log.info("æ­£åœ¨åŒæ­¥è®¢å•ï¼š{}", order.getId());
```

åŒæ­¥ 10 ä¸‡ä¸ªè®¢å•ï¼Œæ¯æ¬¡æ‰§è¡Œä¸€æ¬¡ï¼Œç”Ÿæˆ 10 ä¸‡æ¡æ—¥å¿—ã€‚

**åæœå°±æ˜¯æ—¥å¿—çˆ†ç‚¸ï¼Œç£ç›˜çˆ†æ»¡ï¼Œç”šè‡³å½±å“å…¶ä»–æœåŠ¡å†™æ—¥å¿—ã€‚**

#### æ­£ç¡®å§¿åŠ¿ï¼š
+ æ‰“ç‚¹å¼æ—¥å¿—ï¼š**åªè®°å½•å…³é”®æŒ‡æ ‡ï¼Œæ¯”å¦‚æ¯è½®æ‰§è¡Œçš„æ—¶é—´ã€å¤„ç†æ¡æ•°ã€å¼‚å¸¸æ•°ã€‚**
+ åŠ é™é¢‘å™¨ï¼šç”¨å¸ƒéš†è¿‡æ»¤å™¨ã€è®¡æ•°å™¨ç­‰æ‰‹æ®µï¼Œåªè®°å½•ä»£è¡¨æ€§å¼‚å¸¸ã€‚
+ æ—¥å¿—åˆ†çº§å†™åˆ°ä¸åŒçš„æ–‡ä»¶ï¼ŒInfo å’Œ Error åˆ†ç¦»ã€‚



## ä¸‰ã€å¦‚æœä½ è¿˜åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹â€¦â€¦
é‚£äº‹æƒ…å°±æ›´â€œæœ‰è¶£â€äº†ã€‚

ä½ æœ‰ä¸¤ä¸ªèŠ‚ç‚¹éƒ½éƒ¨ç½²äº†è¿™ä¸ªæœåŠ¡ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½è·‘äº†ä¸€éå®šæ—¶ä»»åŠ¡ï¼Œç„¶åå®ƒä»¬åœ¨æ•°æ®åº“é‡Œâ€œæ’å•å­â€ï¼Œä½ åå°å‘èµ·çš„è¯·æ±‚éƒ½è¢«â€œå¹¶å‘æ’å…¥â€å†²çˆ†ã€‚

è¿™æ—¶å€™ä½ ç»ˆäºæ„è¯†åˆ°â€”â€”æˆ‘ä¸æ˜¯åœ¨å†™ä»»åŠ¡ï¼Œæˆ‘æ˜¯åœ¨æ¨¡æ‹ŸDDoSæ”»å‡»ã€‚

**æ­£ç¡®å§¿åŠ¿ï¼šåŠ é”ï¼**

#### åŸºäº Redis çš„åˆ†å¸ƒå¼é”ï¼ˆæ¨èï¼‰
```java
boolean locked = redisLock.tryLock("sync_order", 30);
if (locked) {
    try {
        // ä½ çš„é€»è¾‘
    } finally {
        redisLock.unlock("sync_order");
    }
}
```

æˆ–è€…ä½ ç”¨æ•°æ®åº“å®ç°ä¹Ÿå¯ä»¥ï¼Œæ¯æ¬¡æ‰§è¡Œä»»åŠ¡å‰æ’ä¸€æ¡å¯¹åº”çš„è®°å½•ï¼Œå¹¶ä¸”ç”¨æ‰§è¡Œæ‰¹æ¬¡æ¥ä½œå”¯ä¸€ç´¢å¼•ï¼Œå¦‚æœæ’å…¥æˆåŠŸå°±æ‰§è¡Œä»»åŠ¡ï¼Œæ’å…¥å¤±è´¥å°±è·³è¿‡æ‰§è¡Œï¼Œå½“ç„¶å…·ä½“æƒ…å†µè¿˜å¾—è§†é¡¹ç›®è€Œå®šã€‚



## å››ã€ä»»åŠ¡å¤ªæ…¢æ€ä¹ˆåŠï¼Ÿæ’é˜Ÿè¿˜æ˜¯å¹¶å‘ï¼Ÿ
å¦‚æœä»»åŠ¡è€—æ—¶ç‰¹åˆ«é•¿ï¼Œè€ƒè™‘ä»¥ä¸‹ä¼˜åŒ–æ–¹å¼ï¼š

### æ‹†æˆå¤šä¸ªå°ä»»åŠ¡å¼‚æ­¥å¤„ç†
åˆ«åœ¨å®šæ—¶ä»»åŠ¡é‡Œå¹²é‡æ´»å„¿ï¼Œè€Œæ˜¯åªè´Ÿè´£â€œå‘å·æ–½ä»¤â€ã€‚

```java
for (Order order : orders) {
    executorService.submit(() -> orderService.syncOrderStatus(order));
}
```

ç»“åˆçº¿ç¨‹æ± ã€æ¶ˆæ¯é˜Ÿåˆ—ç”šè‡³äº‹ä»¶é©±åŠ¨ï¼Œå®šæ—¶ä»»åŠ¡å¯ä»¥å¹²å¾—æ›´è½»æ¾ã€‚

### åŠ ç›‘æ§ï¼Œåˆ«åšâ€œç›²ç›’ä»»åŠ¡â€
å®šæ—¶ä»»åŠ¡ä¸æŠ¥é”™ä¸ä»£è¡¨æ²¡é—®é¢˜ï¼Œä½ éœ€è¦ï¼š

+ **è®°å½•è€—æ—¶ã€å¤„ç†æ•°é‡ã€å¤±è´¥æ•°é‡**
+ **æ‰“ç‚¹åˆ° Prometheus / Grafana**
+ **åŠ æŠ¥è­¦ï¼šæ¯”å¦‚è¿ç»­æ‰§è¡Œå¤±è´¥3æ¬¡å°±é’‰é’‰/ä¼å¾®æŠ¥è­¦**



## äº”ã€æœ€åæ¥ç‚¹è­¦å¥
> â€œå®šæ—¶ä»»åŠ¡ä¸å‡ºé—®é¢˜ï¼Œæ˜¯å› ä¸ºä½ è¿˜æ²¡ä¸Šçº¿ã€‚â€  
â€œå®šæ—¶ä»»åŠ¡ä¸è¯¥åšå¤ªå¤šäº‹ï¼Œå®ƒåªæ˜¯ä¸ªé—¹é’Ÿï¼Œä¸æ˜¯ä¸ªä¿å§†ã€‚â€  
â€œæ²¡æœ‰ç›‘æ§çš„å®šæ—¶ä»»åŠ¡ï¼Œå°±åƒççœ¼èµ°å¤œè·¯ã€‚â€  
â€œé»˜è®¤é…ç½®çš„ `@Scheduled`ï¼Œæ˜¯å®šæ—¶åŸ‹é›·çš„ç¬¬ä¸€æ­¥ã€‚â€
>



## å…­ã€æ€»ç»“
å®šæ—¶ä»»åŠ¡å°±åƒå¨æˆ¿é‡Œçš„ç‡ƒæ°”ç¶ï¼Œç”¨å¾—å¥½èƒ½ç…®é¥­ï¼Œç”¨ä¸å¥½å°±æŠŠæˆ¿å­çƒ§äº†ã€‚çœ‹ä¼¼ç®€å•çš„æ´»ï¼Œå®åˆ™æš—è—æ€æœºã€‚

ä¸€èµ·æ¥å›é¡¾ä¸€ä¸‹å…³é”®ç‚¹ï¼š

| **è¯¯åŒº** | **æ­£ç¡®å§¿åŠ¿** |
| --- | --- |
| ä½¿ç”¨ `fixedRate`ï¼Œå¿½ç•¥ä»»åŠ¡è€—æ—¶ | è€ƒè™‘ `fixedDelay` æˆ–è‡ªè¡Œæ§åˆ¶è°ƒåº¦é€»è¾‘ |
| ä¸é…çº¿ç¨‹æ± ï¼Œä»»åŠ¡ä¸²è¡Œæ’é˜Ÿ | é…ç½®åˆé€‚çš„ `TaskScheduler` çº¿ç¨‹æ±  |
| æ¯ä¸ªèŠ‚ç‚¹éƒ½æ‰§è¡Œä»»åŠ¡ | åŠ  Redis é”æˆ–æŒ‡å®šä¸»èŠ‚ç‚¹ |
| æ—¥å¿—æ— é™è¾“å‡º | æ§åˆ¶æ—¥å¿—é‡ã€æ‰“ç‚¹è®°å½•ã€å¼‚å¸¸èšåˆ |
| æ²¡æœ‰ç›‘æ§ | æ·»åŠ ä»»åŠ¡è¿è¡ŒæŒ‡æ ‡ï¼Œè®¾ç«‹æŠ¥è­¦æœºåˆ¶ |


ç°åœ¨å¤§å®¶ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨å®šæ—¶ä»»åŠ¡ä¸­é—´ä»¶ï¼Œæ¯”å¦‚XXL-JOBï¼Œä½†ä¸æ’é™¤å¯èƒ½ä¼šæœ‰äº›ç‰¹æ®Šçš„åœºæ™¯ç”¨åˆ° `@Scheduled`æ³¨è§£ï¼Œè€Œæ­£æ˜¯å› ä¸ºå¾ˆå°‘ä½¿ç”¨è¿™ä¸ªæ³¨è§£ï¼Œå¯¹å®ƒä¸å¤Ÿäº†è§£ï¼Œä»è€Œå¯¼è‡´çº¿ä¸Šæ•…éšœçš„äº§ç”Ÿï¼Œç­‰åˆ°é‚£æ—¶å°±åæ‚”è«åŠäº†ã€‚

éƒ½çœ‹åˆ°è¿™äº†ï¼Œä¸å¦¨ç‚¹ä¸ªèµæ”¯æŒä¸€ä¸‹ä½œè€…~

> æˆ‘æ˜¯é˜¿æ†ï¼Œä¸€ä¸ªæ™®æ™®é€šé€šçš„ç¨‹åºå‘˜æœ‹å‹ã€‚
>

<!-- è¿™æ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œocr å†…å®¹ä¸ºï¼š -->
![](https://cdn.nlark.com/yuque/0/2025/jpeg/29587979/1750056214431-78f8092c-0815-4b31-98d0-80f93a195553.jpeg)

